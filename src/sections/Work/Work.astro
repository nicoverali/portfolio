---
import FeaturedProject from "./elements/FeaturedProject/FeaturedProject.astro";
import { getCollection } from "astro:content";
import SectionTitle from "@components/SectionTitle/SectionTitle.astro";

const allProjects = await getCollection("projects");
---

<div class="container">
  <SectionTitle>See my work</SectionTitle>

  <astro-projects-grid>
    <div class="projects-grid">
      {
        allProjects.map((project, i) => (
          <div class:list={["project-container", { first: i === 0 }]}>
            <FeaturedProject project={project} />
          </div>
        ))
      }
    </div>
  </astro-projects-grid>
</div>

<style lang="scss">
  @import "../../styles/variables.scss";
  @import "../../styles/screens.scss";

  .projects-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    grid-auto-flow: row;
    grid-column-gap: $col-gutter;
    column-gap: $col-gutter;
    margin-top: var(--spacing-3xl);

    @media screen and (max-width: $screen-md-min) {
      grid-template-columns: minmax(0, 1fr);
    }
  }

  .project-container {
    &:nth-child(even) {
      margin-top: var(--spacing-3xl);
    }

    @media screen and (max-width: $screen-md-min) {
      &:not(:first-child) {
        margin-top: var(--spacing-3xl);
      }
    }
  }
</style>

<script>
  import { vhPercent } from "@scripts/utils/gsap";
  import { gsap } from "gsap";

  class ProjectsGridContainer extends HTMLElement {
    constructor() {
      super();

      gsap.context(() => {
        const projects = gsap.utils.toArray<HTMLElement>(".project-container");

        for (const project of projects) {
          gsap.from(project, {
            scale: 0.9,
            opacity: 0.4,
            y: 100,
            scrollTrigger: {
              trigger: project,
              start: "top " + vhPercent(100),
              end: "top " + vhPercent(60),
              scrub: 1,
            },
          });
        }
      }, this);
    }
  }

  customElements.define("astro-projects-grid", ProjectsGridContainer);
</script>
