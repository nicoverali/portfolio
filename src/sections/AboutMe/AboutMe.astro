---
import Card from "@components/Card/Card.astro";
import GridCol from "@components/Grid/GridCol.astro";
import GridOffset from "@components/Grid/GridOffset.astro";
import GridRow from "@components/Grid/GridRow.astro";
import LinkButton from "@components/LinkButton/LinkButton.astro";
---

<astro-about-me-anim-container>
  <div class="about-me">
    <GridRow>
      <GridOffset xs={2} />
      <GridCol xs={10}>
        <div class="background-text-container">
          <p class="background-text">Currently based in Argentina</p>
        </div>
      </GridCol>
    </GridRow>

    <div class="top">
      <GridRow yAlign={{ xs: "middle" }}>
        <GridCol xs={6}>
          <h2>
            <span>Hey! ðŸ‘‹</span>
            <span>I'm NicolÃ¡s Vera</span>
            <span>a Software Engineer</span>
          </h2>
        </GridCol>
        <GridCol xs={6}>
          <div class="cards-container">
            <div class="card">
              <Card>
                <p>
                  I am a
                  <span class="highlight">Computer Science graduate</span>
                  with a passion for technology.
                </p>
              </Card>
            </div>

            <div class="card">
              <Card>
                <p>
                  I understand the importance of
                  <span class="highlight">user experience</span> and always strive
                  to create intuitive and enjoyable experiences for the people using
                  my applications.
                </p>
              </Card>
            </div>
            <div class="card">
              <Card>
                <p>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed
                  <span class="highlight">vitae dictum sapien</span>. Nam mollis
                  pellentesque quam eget consequat.
                </p>
              </Card>
            </div>
          </div>
        </GridCol>
      </GridRow>
    </div>

    <GridRow>
      <GridCol xs={2}>
        <div class="download-cv">
          <LinkButton href=""> Download CV </LinkButton>
        </div>
      </GridCol>
      <GridCol xs="auto">
        <div class="skills">
          <img src="/media/skills/Docker.svg" />
          <img src="/media/skills/java.svg" />
          <img src="/media/skills/Javascript.svg" />
          <img src="/media/skills/MongoDb.svg" />
          <img src="/media/skills/nestjs.svg" />
          <img src="/media/skills/NextJs.svg" />
          <img src="/media/skills/NodeJs.svg" />
          <img src="/media/skills/PostgreSQL.svg" />
          <img src="/media/skills/React.svg" />
          <img src="/media/skills/Typescript.svg" />
        </div>
      </GridCol>
    </GridRow>
  </div>
</astro-about-me-anim-container>

<style>
  .about-me {
    position: relative;
    display: flex;
    flex-direction: column;
    padding-bottom: 64px;
    height: calc(100vh - var(--el-header-height));
  }

  .background-text {
    position: absolute;
    margin: 0;
    z-index: -1;
    opacity: 0.5;
    top: var(--spacing-lg);
    text-align: right;
    color: var(--color-primary);
    font-size: var(--font-size-display);
  }

  .top {
    margin-top: var(--spacing-xxl);
    flex: 1;
  }

  h2 {
    display: flex;
    flex-direction: column;
    flex: 1;
    position: relative;
    font-size: var(--font-size-h1);
    font-weight: normal;
    line-height: 150%;
  }

  h2 span:last-child {
    position: relative;
  }
  h2 span:last-child::after {
    content: "";
    position: absolute;
    z-index: -1;
    height: 100%;
    width: 100%;
    left: 64px;
    top: 30%;
    bottom: 0;
    background-color: var(--color-primary);
    -webkit-mask-image: url(/media/brushed.svg);
    mask-image: url(/media/brushed.svg);
    mask-size: contain;
    mask-repeat: no-repeat;
  }

  .cards-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-top: var(--spacing-xxl);
  }

  .cards-container .card:nth-child(1) {
    position: relative;
    width: 70%;
    left: var(--spacing-lg);
  }

  .cards-container .card:nth-child(2) {
    position: relative;
    left: var(--spacing-xxl);
    width: calc(100% - var(--spacing-xxl));
  }

  .cards-container .card:nth-child(3) {
    position: relative;
    width: 80%;
  }

  .cards-container .card .highlight {
    font-weight: 600;
  }

  .download-cv {
    height: 100%;
    flex: 1;
    border-right: 1px solid var(--color-primary-light-border);
    display: flex;
    align-items: center;
  }

  .skills {
    display: flex;
    flex: 1;
    justify-content: space-between;
  }

  .skills img {
    width: 40px;
    height: 40px;
  }
</style>

<script>
  import { gsap } from "gsap";

  class AboutMeAnimContainer extends HTMLElement {
    constructor() {
      super();
      gsap.context(() => {
        const tl = gsap.timeline({
          delay: 2,
          scrollTrigger: {
            id: "pin",
            markers: true,
            trigger: ".about-me",
            start: "top top+=80",
            end: "+=350%",
            pin: true,
            scrub: 1,
          },
        });

        tl.addLabel("start");
        tl.add(getCardsTimeline(), "+=1");
        tl.add(hideBackgroundText(), "<+=0.5");
        tl.add(showAndHide(tl.totalDuration() + 2), "start");
        tl.add(parallax(tl.totalDuration()), "start");
      }, this);
    }
  }

  function getCardsTimeline() {
    const tl = gsap.timeline();
    tl.fromTo(
      ".card",
      {
        opacity: 0,
        boxShadow: (_i, _c, all) => {
          const maxElevation = (all.length - 1) * 2;
          return `0 ${maxElevation}px ${maxElevation}px 0 var(--color-shadow)`;
        },
      },
      {
        stagger: 1,
        keyframes: [
          {
            opacity: 1,
            y: (i) => (-i - 1) * 16,
          },
          {
            boxShadow: (i) => `0 ${i * 2}px ${i * 2}px 0 var(--color-shadow)`,
          },
        ],
      }
    );
    return tl;
  }

  function hideBackgroundText() {
    return gsap.to(".background-text-container", {
      opacity: 0,
      duration: 2,
    });
  }

  function showAndHide(duration: number) {
    return gsap.from(
      ".background-text, .cards-container, h2 span, .download-cv, .skills img",
      {
        ease: "slow(0.7,0.9,true)",
        opacity: 0,
        duration,
        stagger: 0.1,
      }
    );
  }

  function parallax(duration: number) {
    const tl = gsap.timeline({
      defaults: { duration, ease: "slow(0.2,0.9,false)" },
    });
    const distance = 800;
    tl.fromTo(
      ".background-text",
      { y: distance / 2 },
      { y: -distance / 2 },
      "start"
    );
    tl.fromTo(
      "h2, .download-cv, .skills, .cards-container",
      { y: distance },
      { y: -distance },
      "start"
    );
    return tl;
  }

  customElements.define("astro-about-me-anim-container", AboutMeAnimContainer);
</script>
